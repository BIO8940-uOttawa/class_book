<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6.1 Practical | BIO8940 Advanced stats and Open Science</title>
  <meta name="description" content="Theory and practicals for BIO8940 course at the University of Ottawa" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="6.1 Practical | BIO8940 Advanced stats and Open Science" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/missing.png" />
  <meta property="og:description" content="Theory and practicals for BIO8940 course at the University of Ottawa" />
  <meta name="github-repo" content="BIO8940-uOttawa/class_book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6.1 Practical | BIO8940 Advanced stats and Open Science" />
  
  <meta name="twitter:description" content="Theory and practicals for BIO8940 course at the University of Ottawa" />
  <meta name="twitter:image" content="images/missing.png" />

<meta name="author" content="Julien Martin" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="6-introduction-to-glmm.html"/>
<link rel="next" href="7-introduction-to-bayesian-inference.html"/>
<script src="libs/header-attrs-2.7.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced stats and open science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Note</a></li>
<li class="chapter" data-level="" data-path="préface.html"><a href="préface.html"><i class="fa fa-check"></i>Préface</a>
<ul>
<li class="chapter" data-level="" data-path="quelques-points-importants-à-retenir.html"><a href="quelques-points-importants-à-retenir.html"><i class="fa fa-check"></i>Quelques points importants à retenir</a></li>
<li class="chapter" data-level="" data-path="quest-ce-que-r-et-pourquoi-lutiliser-dans-ce-cours.html"><a href="quest-ce-que-r-et-pourquoi-lutiliser-dans-ce-cours.html"><i class="fa fa-check"></i>Qu’est-ce que R et pourquoi l’utiliser dans ce cours?</a></li>
<li class="chapter" data-level="" data-path="installation-des-logiciels-nécessaires.html"><a href="installation-des-logiciels-nécessaires.html"><i class="fa fa-check"></i>Installation des logiciels nécessaires</a>
<ul>
<li class="chapter" data-level="" data-path="installation-des-logiciels-nécessaires.html"><a href="installation-des-logiciels-nécessaires.html#r"><i class="fa fa-check"></i>R</a></li>
<li class="chapter" data-level="0.0.1" data-path="installation-des-logiciels-nécessaires.html"><a href="installation-des-logiciels-nécessaires.html#text-editor-or-ide"><i class="fa fa-check"></i><b>0.0.1</b> Text editor or IDE</a></li>
<li class="chapter" data-level="" data-path="installation-des-logiciels-nécessaires.html"><a href="installation-des-logiciels-nécessaires.html#paquets-pour-r"><i class="fa fa-check"></i>Paquets pour R</a></li>
<li class="chapter" data-level="" data-path="installation-des-logiciels-nécessaires.html"><a href="installation-des-logiciels-nécessaires.html#pandoc"><i class="fa fa-check"></i>pandoc</a></li>
<li class="chapter" data-level="" data-path="installation-des-logiciels-nécessaires.html"><a href="installation-des-logiciels-nécessaires.html#latex"><i class="fa fa-check"></i>laTex</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instructions-générales-pour-les-laboratoires.html"><a href="instructions-générales-pour-les-laboratoires.html"><i class="fa fa-check"></i>Instructions générales pour les laboratoires</a></li>
<li class="chapter" data-level="" data-path="notes-sur-le-manuel.html"><a href="notes-sur-le-manuel.html"><i class="fa fa-check"></i>Notes sur le manuel</a>
<ul>
<li class="chapter" data-level="" data-path="notes-sur-le-manuel.html"><a href="notes-sur-le-manuel.html#resources"><i class="fa fa-check"></i>Resources</a></li>
<li class="chapter" data-level="" data-path="notes-sur-le-manuel.html"><a href="notes-sur-le-manuel.html#licence"><i class="fa fa-check"></i>Licence</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Open Science</b></span></li>
<li class="chapter" data-level="1" data-path="1-introduction-to-open-science.html"><a href="1-introduction-to-open-science.html"><i class="fa fa-check"></i><b>1</b> Introduction to open Science</a></li>
<li class="chapter" data-level="2" data-path="2-introduction-to-rmarkdown.html"><a href="2-introduction-to-rmarkdown.html"><i class="fa fa-check"></i><b>2</b> Introduction to Rmarkdown</a>
<ul>
<li class="chapter" data-level="2.1" data-path="2-1-practical.html"><a href="2-1-practical.html"><i class="fa fa-check"></i><b>2.1</b> Practical</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="2-1-practical.html"><a href="2-1-practical.html#context"><i class="fa fa-check"></i><b>2.1.1</b> Context</a></li>
<li class="chapter" data-level="2.1.2" data-path="2-1-practical.html"><a href="2-1-practical.html#questions"><i class="fa fa-check"></i><b>2.1.2</b> Questions</a></li>
<li class="chapter" data-level="" data-path="2-1-practical.html"><a href="2-1-practical.html#example-of-output"><i class="fa fa-check"></i>Example of output</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-introduction-to-github-with-r.html"><a href="3-introduction-to-github-with-r.html"><i class="fa fa-check"></i><b>3</b> Introduction to github with R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="3-1-practical-1.html"><a href="3-1-practical-1.html"><i class="fa fa-check"></i><b>3.1</b> Practical</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="3-1-practical-1.html"><a href="3-1-practical-1.html#context-1"><i class="fa fa-check"></i><b>3.1.1</b> Context</a></li>
<li class="chapter" data-level="3.1.2" data-path="3-1-practical-1.html"><a href="3-1-practical-1.html#information-of-the-data"><i class="fa fa-check"></i><b>3.1.2</b> Information of the data</a></li>
<li class="chapter" data-level="3.1.3" data-path="3-1-practical-1.html"><a href="3-1-practical-1.html#questions-1"><i class="fa fa-check"></i><b>3.1.3</b> Questions</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Statistics</b></span></li>
<li class="chapter" data-level="4" data-path="4-refresher-on-glm.html"><a href="4-refresher-on-glm.html"><i class="fa fa-check"></i><b>4</b> Refresher on <code>glm</code></a></li>
<li class="chapter" data-level="5" data-path="5-introduction-to-linear-mixed-models.html"><a href="5-introduction-to-linear-mixed-models.html"><i class="fa fa-check"></i><b>5</b> Introduction to linear mixed models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="5-1-shrinkage.html"><a href="5-1-shrinkage.html"><i class="fa fa-check"></i><b>5.1</b> Shrinkage</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="5-1-shrinkage.html"><a href="5-1-shrinkage.html#analysis"><i class="fa fa-check"></i><b>5.1.1</b> Analysis</a></li>
<li class="chapter" data-level="5.1.2" data-path="5-1-shrinkage.html"><a href="5-1-shrinkage.html#data"><i class="fa fa-check"></i><b>5.1.2</b> Data</a></li>
<li class="chapter" data-level="5.1.3" data-path="5-1-shrinkage.html"><a href="5-1-shrinkage.html#run-the-baseline-model"><i class="fa fa-check"></i><b>5.1.3</b> Run the baseline model</a></li>
<li class="chapter" data-level="5.1.4" data-path="5-1-shrinkage.html"><a href="5-1-shrinkage.html#visualize-the-baseline-model"><i class="fa fa-check"></i><b>5.1.4</b> Visualize the baseline model</a></li>
<li class="chapter" data-level="5.1.5" data-path="5-1-shrinkage.html"><a href="5-1-shrinkage.html#summary"><i class="fa fa-check"></i><b>5.1.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="5-2-practical-2.html"><a href="5-2-practical-2.html"><i class="fa fa-check"></i><b>5.2</b> Practical</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="5-2-practical-2.html"><a href="5-2-practical-2.html#overview"><i class="fa fa-check"></i><b>5.2.1</b> Overview</a></li>
<li class="chapter" data-level="5.2.2" data-path="5-2-practical-2.html"><a href="5-2-practical-2.html#r-packages-needed"><i class="fa fa-check"></i><b>5.2.2</b> R packages needed</a></li>
<li class="chapter" data-level="5.2.3" data-path="5-2-practical-2.html"><a href="5-2-practical-2.html#the-superb-wild-unicorns-of-the-scottish-highlands"><i class="fa fa-check"></i><b>5.2.3</b> The superb wild unicorns of the Scottish Highlands</a></li>
<li class="chapter" data-level="5.2.4" data-path="5-2-practical-2.html"><a href="5-2-practical-2.html#do-unicorns-differ-in-aggressiveness-your-first-mixed-model"><i class="fa fa-check"></i><b>5.2.4</b> Do unicorns differ in aggressiveness? Your first mixed model</a></li>
<li class="chapter" data-level="5.2.5" data-path="5-2-practical-2.html"><a href="5-2-practical-2.html#do-unicorns-differ-in-aggressiveness-a-better-mixed-model"><i class="fa fa-check"></i><b>5.2.5</b> Do unicorns differ in aggressiveness? A better mixed model</a></li>
<li class="chapter" data-level="5.2.6" data-path="5-2-practical-2.html"><a href="5-2-practical-2.html#what-is-the-repeatability"><i class="fa fa-check"></i><b>5.2.6</b> What is the repeatability?</a></li>
<li class="chapter" data-level="5.2.7" data-path="5-2-practical-2.html"><a href="5-2-practical-2.html#a-quick-note-on-uncertainty"><i class="fa fa-check"></i><b>5.2.7</b> A quick note on uncertainty</a></li>
<li class="chapter" data-level="5.2.8" data-path="5-2-practical-2.html"><a href="5-2-practical-2.html#an-easy-way-to-mess-up-your-mixed-models"><i class="fa fa-check"></i><b>5.2.8</b> An easy way to mess up your mixed models</a></li>
<li class="chapter" data-level="5.2.9" data-path="5-2-practical-2.html"><a href="5-2-practical-2.html#happy-mixed-modelling"><i class="fa fa-check"></i><b>5.2.9</b> Happy mixed-modelling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-introduction-to-glmm.html"><a href="6-introduction-to-glmm.html"><i class="fa fa-check"></i><b>6</b> Introduction to <code>GLMM</code></a>
<ul>
<li class="chapter" data-level="6.1" data-path="6-1-practical-3.html"><a href="6-1-practical-3.html"><i class="fa fa-check"></i><b>6.1</b> Practical</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="6-1-practical-3.html"><a href="6-1-practical-3.html#packages-and-functions"><i class="fa fa-check"></i><b>6.1.1</b> Packages and functions</a></li>
<li class="chapter" data-level="6.1.2" data-path="6-1-practical-3.html"><a href="6-1-practical-3.html#the-data-set"><i class="fa fa-check"></i><b>6.1.2</b> The data set</a></li>
<li class="chapter" data-level="6.1.3" data-path="6-1-practical-3.html"><a href="6-1-practical-3.html#specifying-fixed-and-random-effects"><i class="fa fa-check"></i><b>6.1.3</b> Specifying fixed and random Effects</a></li>
<li class="chapter" data-level="6.1.4" data-path="6-1-practical-3.html"><a href="6-1-practical-3.html#look-at-overall-patterns-in-data"><i class="fa fa-check"></i><b>6.1.4</b> Look at overall patterns in data</a></li>
<li class="chapter" data-level="6.1.5" data-path="6-1-practical-3.html"><a href="6-1-practical-3.html#choose-an-error-distribution"><i class="fa fa-check"></i><b>6.1.5</b> Choose an error distribution</a></li>
<li class="chapter" data-level="6.1.6" data-path="6-1-practical-3.html"><a href="6-1-practical-3.html#fitting-group-wise-glm"><i class="fa fa-check"></i><b>6.1.6</b> Fitting group-wise GLM</a></li>
<li class="chapter" data-level="6.1.7" data-path="6-1-practical-3.html"><a href="6-1-practical-3.html#fitting-and-evaluating-glmms"><i class="fa fa-check"></i><b>6.1.7</b> Fitting and evaluating GLMMs</a></li>
<li class="chapter" data-level="6.1.8" data-path="6-1-practical-3.html"><a href="6-1-practical-3.html#inference"><i class="fa fa-check"></i><b>6.1.8</b> Inference</a></li>
<li class="chapter" data-level="6.1.9" data-path="6-1-practical-3.html"><a href="6-1-practical-3.html#conclusions"><i class="fa fa-check"></i><b>6.1.9</b> Conclusions</a></li>
<li class="chapter" data-level="6.1.10" data-path="6-1-practical-3.html"><a href="6-1-practical-3.html#happy-generalized-mixed-modelling"><i class="fa fa-check"></i><b>6.1.10</b> Happy generalized mixed-modelling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="7-introduction-to-bayesian-inference.html"><a href="7-introduction-to-bayesian-inference.html"><i class="fa fa-check"></i><b>7</b> Introduction to <code>Bayesian Inference</code></a>
<ul>
<li class="chapter" data-level="7.1" data-path="7-1-theory.html"><a href="7-1-theory.html"><i class="fa fa-check"></i><b>7.1</b> theory</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="7-1-theory.html"><a href="7-1-theory.html#bayes-theorem"><i class="fa fa-check"></i><b>7.1.1</b> Bayes’ theorem</a></li>
<li class="chapter" data-level="7.1.2" data-path="7-1-theory.html"><a href="7-1-theory.html#intro-to-mcmc"><i class="fa fa-check"></i><b>7.1.2</b> Intro to MCMC</a></li>
<li class="chapter" data-level="7.1.3" data-path="7-1-theory.html"><a href="7-1-theory.html#inferences-1"><i class="fa fa-check"></i><b>7.1.3</b> Inferences</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="7-2-practical-4.html"><a href="7-2-practical-4.html"><i class="fa fa-check"></i><b>7.2</b> Practical</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="7-2-practical-4.html"><a href="7-2-practical-4.html#r-packages-needed-1"><i class="fa fa-check"></i><b>7.2.1</b> R packages needed</a></li>
<li class="chapter" data-level="7.2.2" data-path="7-2-practical-4.html"><a href="7-2-practical-4.html#a-refresher-on-unicorn-ecology"><i class="fa fa-check"></i><b>7.2.2</b> A refresher on unicorn ecology</a></li>
<li class="chapter" data-level="7.2.3" data-path="7-2-practical-4.html"><a href="7-2-practical-4.html#mcmcglmm"><i class="fa fa-check"></i><b>7.2.3</b> MCMCglmm</a></li>
<li class="chapter" data-level="7.2.4" data-path="7-2-practical-4.html"><a href="7-2-practical-4.html#inferences-2"><i class="fa fa-check"></i><b>7.2.4</b> Inferences</a></li>
<li class="chapter" data-level="7.2.5" data-path="7-2-practical-4.html"><a href="7-2-practical-4.html#brms"><i class="fa fa-check"></i><b>7.2.5</b> brms</a></li>
<li class="chapter" data-level="7.2.6" data-path="7-2-practical-4.html"><a href="7-2-practical-4.html#inferences-3"><i class="fa fa-check"></i><b>7.2.6</b> Inferences</a></li>
<li class="chapter" data-level="7.2.7" data-path="7-2-practical-4.html"><a href="7-2-practical-4.html#happy-bayesian-stats"><i class="fa fa-check"></i><b>7.2.7</b> Happy Bayesian stats</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="8-random-regressions-and-multivariate-mixed-models.html"><a href="8-random-regressions-and-multivariate-mixed-models.html"><i class="fa fa-check"></i><b>8</b> Random regressions and multivariate mixed models</a>
<ul>
<li class="chapter" data-level="8.1" data-path="8-1-theory-1.html"><a href="8-1-theory-1.html"><i class="fa fa-check"></i><b>8.1</b> theory</a></li>
<li class="chapter" data-level="8.2" data-path="8-2-practical-5.html"><a href="8-2-practical-5.html"><i class="fa fa-check"></i><b>8.2</b> Practical</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="8-2-practical-5.html"><a href="8-2-practical-5.html#r-packages-needed-2"><i class="fa fa-check"></i><b>8.2.1</b> R packages needed</a></li>
<li class="chapter" data-level="8.2.2" data-path="8-2-practical-5.html"><a href="8-2-practical-5.html#the-blue-dragon-of-the-west"><i class="fa fa-check"></i><b>8.2.2</b> The blue dragon of the west</a></li>
<li class="chapter" data-level="8.2.3" data-path="8-2-practical-5.html"><a href="8-2-practical-5.html#multiple-univariate-models"><i class="fa fa-check"></i><b>8.2.3</b> Multiple univariate models</a></li>
<li class="chapter" data-level="8.2.4" data-path="8-2-practical-5.html"><a href="8-2-practical-5.html#multivariate-approach"><i class="fa fa-check"></i><b>8.2.4</b> Multivariate approach</a></li>
<li class="chapter" data-level="8.2.5" data-path="8-2-practical-5.html"><a href="8-2-practical-5.html#happy-multivariate-models"><i class="fa fa-check"></i><b>8.2.5</b> Happy multivariate models</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Appendix</b></span></li>
<li class="chapter" data-level="" data-path="r-1.html"><a href="r-1.html"><i class="fa fa-check"></i>R</a></li>
<li class="chapter" data-level="" data-path="to-do-list.html"><a href="to-do-list.html"><i class="fa fa-check"></i>To do list</a></li>
<li class="chapter" data-level="" data-path="list-of-r-packages-used-in-this-book.html"><a href="list-of-r-packages-used-in-this-book.html"><i class="fa fa-check"></i>List of R packages used in this book</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">BIO8940 Advanced stats and Open Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="practical-3" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Practical</h2>
<p>Spatial variation in nutrient availability and herbivory is likely to cause pop-ulation differentiation and maintain genetic diversity in plant populations.Here we measure the extent to which mouse-ear cress (Arabidopsis thaliana)exhibits population and genotypic variation in their responses to these im-portant environmental factors. We are particularly interested in whetherthese populations exhibit nutrient mediated compensation, where higher nutrient levels allow genotypes to better tolerate herbivory (Banta et al.,2010). We use GLMMs to estimate the effect of nutrient levels, simulated hebivory, and their interaction on fruit production in Arabidopsis thaliana(fixed effects), and the extent to which populations vary in their responses(random effects, or variance components)</p>
<div id="packages-and-functions" class="section level3" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Packages and functions</h3>
<p>You need to download the “extra_funs.R” script for some functions used in the Practical</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="6-1-practical-3.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb63-2"><a href="6-1-practical-3.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb63-3"><a href="6-1-practical-3.html#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb63-4"><a href="6-1-practical-3.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb63-5"><a href="6-1-practical-3.html#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;data/extra_funs.R&quot;</span>)</span></code></pre></div>
</div>
<div id="the-data-set" class="section level3" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> The data set</h3>
<p>In this data set, the response variable is the number of fruits (i.e. seedcapsules) per plant. The number of fruits produced by an individual plant(the experimental unit) was hypothesized to be a function of fixed effects,including nutrient levels (low vs. high), simulated herbivory (none vs. apicalmeristem damage), region (Sweden, Netherlands, Spain), and interactionsamong these. Fruit number was also a function of random effects including both the population and individual genotype. Because Arabidopsis is highlyselfing, seeds of a single individual served as replicates of that individual.There were also nuisance variables, including the placement of the plantin the greenhouse, and the method used to germinate seeds. These were estimated as fixed effects but interactions were excluded.</p>
<ul>
<li><code>X</code> observation number (we will use this observation number later, when we are accounting for overdispersion)</li>
<li><code>reg</code> a factor for region (Netherlands, Spain, Sweden).</li>
<li><code>popu</code> a factor with a level for each population.</li>
<li><code>gen</code> a factor with a level for each genotype.</li>
<li><code>rack</code> a nuisance factor for one of two greenhouse racks.</li>
<li><code>nutrient</code> a factor with levels for minimal or additional nutrients.</li>
<li><code>amd</code> a factor with levels for no damage or simulated herbivory (apical meristem damage; we will sometimes refer to this as “clipping”)</li>
<li><code>status</code> a nuisance factor for germination method.</li>
<li><code>total.fruits</code> the response; an integer count of the number of fruits perplant.</li>
</ul>
</div>
<div id="specifying-fixed-and-random-effects" class="section level3" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Specifying fixed and random Effects</h3>
<p>Here we need to select a realistic full model, based on the scientific ques-tions and the data actually at hand. We first load the data set and makesure that each variable is appropriately designated as numeric or factor (i.e.categorical variable).</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="6-1-practical-3.html#cb64-1" aria-hidden="true" tabindex="-1"></a>dat_tf <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/Banta_TotalFruits.csv&quot;</span>)</span>
<span id="cb64-2"><a href="6-1-practical-3.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dat_tf)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    625 obs. of  9 variables:
##  $ X           : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ reg         : chr  &quot;NL&quot; &quot;NL&quot; &quot;NL&quot; &quot;NL&quot; ...
##  $ popu        : chr  &quot;3.NL&quot; &quot;3.NL&quot; &quot;3.NL&quot; &quot;3.NL&quot; ...
##  $ gen         : int  4 4 4 4 4 4 4 4 4 5 ...
##  $ rack        : int  2 1 1 2 2 2 2 1 2 1 ...
##  $ nutrient    : int  1 1 1 1 8 1 1 1 8 1 ...
##  $ amd         : chr  &quot;clipped&quot; &quot;clipped&quot; &quot;clipped&quot; &quot;clipped&quot; ...
##  $ status      : chr  &quot;Transplant&quot; &quot;Petri.Plate&quot; &quot;Normal&quot; &quot;Normal&quot; ...
##  $ total.fruits: int  0 0 0 0 0 0 0 3 2 0 ...</code></pre>
<p>The <code>X</code>, <code>gen</code>, <code>rack</code> and <code>nutrient</code> variables are coded as integers, but we want them to be factors.
 We use transform(), which operates within the data set, to avoid typing lots of commands like <code>dat_tf$rack &lt;- factor(dat_tf$rack)</code>
 At the same time, we reorder the <code>clipping</code> variable so that <code>"unclipped"</code> is the reference level (we could also have used <code>relevel(amd,"unclipped")</code>).</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="6-1-practical-3.html#cb66-1" aria-hidden="true" tabindex="-1"></a>dat_tf <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb66-2"><a href="6-1-practical-3.html#cb66-2" aria-hidden="true" tabindex="-1"></a>  dat_tf,</span>
<span id="cb66-3"><a href="6-1-practical-3.html#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> <span class="fu">factor</span>(X),</span>
<span id="cb66-4"><a href="6-1-practical-3.html#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">gen =</span> <span class="fu">factor</span>(gen),</span>
<span id="cb66-5"><a href="6-1-practical-3.html#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">rack =</span> <span class="fu">factor</span>(rack),</span>
<span id="cb66-6"><a href="6-1-practical-3.html#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">amd =</span> <span class="fu">factor</span>(amd, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;unclipped&quot;</span>, <span class="st">&quot;clipped&quot;</span>)),</span>
<span id="cb66-7"><a href="6-1-practical-3.html#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">nutrient =</span> <span class="fu">factor</span>(nutrient, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;High&quot;</span>))</span>
<span id="cb66-8"><a href="6-1-practical-3.html#cb66-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Now we check replication for each genotype (columns) within each population (rows).</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="6-1-practical-3.html#cb67-1" aria-hidden="true" tabindex="-1"></a>(reptab <span class="ot">&lt;-</span> <span class="fu">with</span>(dat_tf, <span class="fu">table</span>(popu, gen)))</span></code></pre></div>
<pre><code>##       gen
## popu    4  5  6 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 27 28 30 34 35 36
##   1.SP  0  0  0  0  0 39 26 35  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##   1.SW  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 28 20  0  0  0  0  0
##   2.SW  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 18 14  0  0  0
##   3.NL 31 11 13  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##   5.NL  0  0  0 35 26  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##   5.SP  0  0  0  0  0  0  0  0 43 22 12  0  0  0  0  0  0  0  0  0  0  0  0  0
##   6.SP  0  0  0  0  0  0  0  0  0  0  0 13 24 14  0  0  0  0  0  0  0  0  0  0
##   7.SW  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 45 47 45
##   8.SP  0  0  0  0  0  0  0  0  0  0  0  0  0  0 13 16 35  0  0  0  0  0  0  0</code></pre>

<div class="rmdcode">
<p><strong>Exercise</strong>: this mode of inspection is OK for this data set but might fail for much larger data sets or for more levels of nesting. See if you can think of some other numerical or graphical methods for inspecting the structure of data sets.</p>
<ol style="list-style-type: decimal">
<li>plot(reptab) gives a mosaic plot of the two-way table; examine this, see if you can figure out how to interpret it, and decide whether you think it might be useful</li>
<li>try the commands colSums(reptab&gt;0) (and the equivalent for rowSums) and figure out what they are telling you.</li>
<li>Using this recipe, how would you compute the range of number of genotypes per treatment combination?</li>
</ol>
</div>
<div class="exer">
<ol style="list-style-type: decimal">
<li>Do you find the mosaic plot you obtained ugly and super hard to read? Me too 🤣</li>
</ol>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="6-1-practical-3.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(reptab)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-32"></span>
<img src="BIO8940_book_files/figure-html/unnamed-chunk-32-1.svg" alt="A truly useless plot no one can understand" width="672" />
<p class="caption">
Figure 6.1: A truly useless plot no one can understand
</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li><code>colSums()</code> do the sum of all the rows for each columns of a table. So <code>colSums(reptab&gt;0)</code> gives you for each genotype the number of populations (lines) where you have at least 1 observations.</li>
</ol>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="6-1-practical-3.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(reptab <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>##  4  5  6 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 27 28 30 34 35 36 
##  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="6-1-practical-3.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rowSums</span>(reptab <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## 1.SP 1.SW 2.SW 3.NL 5.NL 5.SP 6.SP 7.SW 8.SP 
##    3    2    2    3    2    3    3    3    3</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>You firts need to create a new table of number of observations per treatment and genotypes</li>
</ol>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="6-1-practical-3.html#cb74-1" aria-hidden="true" tabindex="-1"></a>reptab2 <span class="ot">&lt;-</span> <span class="fu">with</span>(dat_tf, <span class="fu">table</span>(<span class="fu">paste</span>(amd, nutrient, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>), gen))</span>
<span id="cb74-2"><a href="6-1-practical-3.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(reptab2)</span></code></pre></div>
<pre><code>## [1]  2 13</code></pre>
</div>
<p>This reveals that we have only 2–4 populations per region and 2–3 genotypes per population. However, we also have 2–13 replicates per genotype for each treatment combination (four unique treatment combinations: 2 levels of nutrients by 2 levels of simulated herbivory). Thus, even though this was a reasonably large experiment (625 plants), there were a very small number of replicates with which to estimate variance components, and many more potential interactions than our data can support. Therefore, judicious selection of model terms, based on both biology and the data, is warranted. We note that we don’t really have enough levels per random effect, nor enough replication per unique treatment combination. Therefore, we decide to omit the fixed effect of “region,” although we recognize that populations in different regions are widely geographically separated.</p>
<p>However, as in all GLMMs where the scale parameter is treated as fixed and deviations from the fixed scale parameter would be identifiable (i.e. Poisson and binomial (N &gt; 1), but not binary, models) we may have to deal with overdispersion.</p>
</div>
<div id="look-at-overall-patterns-in-data" class="section level3" number="6.1.4">
<h3><span class="header-section-number">6.1.4</span> Look at overall patterns in data</h3>
<p>I usually like to start with a relatively simple overall plot of the data, disregarding the random factors, just to see what’s going on. For reasons to be discussed below, we choose to look at the data on the log (or log(1 + x) scale. Let’s plot either box-and-whisker plots (useful summaries) or dot plots (more detailed, good for seeing if we missed anything).</p>
<div class="figure"><span id="fig:unnamed-chunk-35"></span>
<img src="BIO8940_book_files/figure-html/unnamed-chunk-35-1.svg" alt="Number of fruits (log + 1) as a function of treatments" width="672" />
<p class="caption">
Figure 6.2: Number of fruits (log + 1) as a function of treatments
</p>
</div>

<div class="rmdcode">
<strong>Exercise</strong> generate these plots and figure out how they work before continuing. Try conditioning/faceting on population rather than region: for facet_wrap you might want to take out the nrow=1 specification. If you want try reorder the subplots by overall mean fruit set and/or colour the points according to the region they come from.
</div>
<div class="exer">
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="6-1-practical-3.html#cb76-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">qplot</span>(</span>
<span id="cb76-2"><a href="6-1-practical-3.html#cb76-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">interaction</span>(nutrient, amd),</span>
<span id="cb76-3"><a href="6-1-practical-3.html#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">+</span> total.fruits),</span>
<span id="cb76-4"><a href="6-1-practical-3.html#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_tf, <span class="at">geom =</span> <span class="st">&quot;boxplot&quot;</span>) <span class="sc">+</span></span>
<span id="cb76-5"><a href="6-1-practical-3.html#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>reg, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb76-6"><a href="6-1-practical-3.html#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>)) <span class="sc">+</span></span>
<span id="cb76-7"><a href="6-1-practical-3.html#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Boxplot&quot;</span>)</span>
<span id="cb76-8"><a href="6-1-practical-3.html#cb76-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">qplot</span>(</span>
<span id="cb76-9"><a href="6-1-practical-3.html#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">interaction</span>(nutrient, amd),</span>
<span id="cb76-10"><a href="6-1-practical-3.html#cb76-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">+</span> total.fruits),</span>
<span id="cb76-11"><a href="6-1-practical-3.html#cb76-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_tf) <span class="sc">+</span></span>
<span id="cb76-12"><a href="6-1-practical-3.html#cb76-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>reg, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb76-13"><a href="6-1-practical-3.html#cb76-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_sum</span>() <span class="sc">+</span></span>
<span id="cb76-14"><a href="6-1-practical-3.html#cb76-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>)) <span class="sc">+</span></span>
<span id="cb76-15"><a href="6-1-practical-3.html#cb76-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Dot plot&quot;</span>)</span>
<span id="cb76-16"><a href="6-1-practical-3.html#cb76-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
</div>
</div>
<div id="choose-an-error-distribution" class="section level3" number="6.1.5">
<h3><span class="header-section-number">6.1.5</span> Choose an error distribution</h3>
<p>The data are non-normal in principle (i.e., count data, so our first guess would be a Poisson distribution). If we transform total fruits with the canonical link function (log), we hope to see relatively homogeneous variances across categories and groups.</p>
<p>First we define a new factor that represents every combination of genotype and treatment (nutrient × clipping) treatment, and sort it in order of increasing mean fruit set.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="6-1-practical-3.html#cb77-1" aria-hidden="true" tabindex="-1"></a>dat_tf <span class="ot">&lt;-</span> dat_tf <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="6-1-practical-3.html#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb77-3"><a href="6-1-practical-3.html#cb77-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">gna =</span> <span class="fu">reorder</span>(<span class="fu">interaction</span>(gen, nutrient, amd), total.fruits, mean)</span>
<span id="cb77-4"><a href="6-1-practical-3.html#cb77-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Now time to plot it</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="6-1-practical-3.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat_tf, <span class="fu">aes</span>(<span class="at">x =</span> gna, <span class="at">y =</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">+</span> total.fruits))) <span class="sc">+</span></span>
<span id="cb78-2"><a href="6-1-practical-3.html#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb78-3"><a href="6-1-practical-3.html#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb78-4"><a href="6-1-practical-3.html#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-39"></span>
<img src="BIO8940_book_files/figure-html/unnamed-chunk-39-1.svg" alt="Boxplot of total fruits (log + 1) per genotypes and treatments" width="672" />
<p class="caption">
Figure 6.3: Boxplot of total fruits (log + 1) per genotypes and treatments
</p>
</div>
<p>We could also calculate the variance for each genotype × treatment combination and provide a statistical summary of these variances.
This reveals substantial variation among the sample variances on the transformed data. In addition to heterogeneous variances across groups, Figure 1 reveals many zeroes in groups, and some groups with a mean and variance of zero, further suggesting we need a non-normal error distribution, and perhaps something other than a Poisson distribution.</p>
<p>We could calculate λ(mean) for each genotype × treatment combination and provide a statistical summary of each group’s λ.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="6-1-practical-3.html#cb79-1" aria-hidden="true" tabindex="-1"></a>grp_means <span class="ot">&lt;-</span> <span class="fu">with</span>(dat_tf, <span class="fu">tapply</span>(total.fruits, <span class="fu">list</span>(gna), mean))</span>
<span id="cb79-2"><a href="6-1-practical-3.html#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(grp_means)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    0.00   11.35   23.16   31.86   49.74  122.40</code></pre>
<p>A core property of the Poisson distribution is that the variance is equal to the mean. A simple diagnostic is a plot of the group variances against the group means:</p>
<ul>
<li>Poisson-distributed data will result in a linear pattern with slope = 1</li>
<li>as long as the variance is generally greater than the mean, we call the data overdispersed. Overdispersion comes in various forms:
<ul>
<li>a linear mean-variance relationship with Var = φµ (a line through the origin) with φ &gt; 1 is called a quasi-Poisson pattern (this term describes the mean-variance relationship, not any particular proability distribution); we can implement it statistically via quasilikelihood (Venables and Ripley, 2002) or by using a particular parameterization of the negative binomial distribution (“NB1” inthe terminology of Hardin and Hilbe (2007))</li>
<li>a semi-quadratic pattern, Var = µ(1 + αµ) or µ(1 + µ/k), is characteristic of overdispersed data that is driven by underlying heterogeneity among samples, either the negative binomial (gamma-Poisson) or the lognormal-Poisson <span class="citation">(<a href="references.html#ref-elston2001" role="doc-biblioref">Elston et al. 2001</a>)</span></li>
</ul></li>
</ul>
<p>We’ve already calculated the group (genotype × treatment) means, we calculate the variances in the same way.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="6-1-practical-3.html#cb81-1" aria-hidden="true" tabindex="-1"></a>grp_vars <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb81-2"><a href="6-1-practical-3.html#cb81-2" aria-hidden="true" tabindex="-1"></a>  dat_tf,</span>
<span id="cb81-3"><a href="6-1-practical-3.html#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tapply</span>(</span>
<span id="cb81-4"><a href="6-1-practical-3.html#cb81-4" aria-hidden="true" tabindex="-1"></a>    total.fruits,</span>
<span id="cb81-5"><a href="6-1-practical-3.html#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(gna), var</span>
<span id="cb81-6"><a href="6-1-practical-3.html#cb81-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-7"><a href="6-1-practical-3.html#cb81-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>We can get approximate estimates of the quasi-Poisson (linear) and negative binomial (linear/quadratic) pattern using lm.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="6-1-practical-3.html#cb82-1" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(grp_vars <span class="sc">~</span> grp_means <span class="sc">-</span> <span class="dv">1</span>) <span class="do">## `quasi-Poisson&#39; fit</span></span>
<span id="cb82-2"><a href="6-1-practical-3.html#cb82-2" aria-hidden="true" tabindex="-1"></a>phi_fit <span class="ot">&lt;-</span> <span class="fu">coef</span>(lm1)</span>
<span id="cb82-3"><a href="6-1-practical-3.html#cb82-3" aria-hidden="true" tabindex="-1"></a>lm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>((grp_vars <span class="sc">-</span> grp_means) <span class="sc">~</span> <span class="fu">I</span>(grp_means<span class="sc">^</span><span class="dv">2</span>) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb82-4"><a href="6-1-practical-3.html#cb82-4" aria-hidden="true" tabindex="-1"></a>k_fit <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">coef</span>(lm2)</span></code></pre></div>
<p>Now we can plot them.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="6-1-practical-3.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(grp_vars <span class="sc">~</span> grp_means, <span class="at">xlab =</span> <span class="st">&quot;group means&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;group variances&quot;</span>)</span>
<span id="cb83-2"><a href="6-1-practical-3.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb83-3"><a href="6-1-practical-3.html#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">105</span>, <span class="dv">500</span>, <span class="st">&quot;Poisson&quot;</span>)</span>
<span id="cb83-4"><a href="6-1-practical-3.html#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(phi_fit <span class="sc">*</span> x, <span class="at">col =</span> <span class="dv">2</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-5"><a href="6-1-practical-3.html#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="do">## bquote() is used to substitute numeric values</span></span>
<span id="cb83-6"><a href="6-1-practical-3.html#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="do">## in equations with symbols</span></span>
<span id="cb83-7"><a href="6-1-practical-3.html#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">110</span>, <span class="dv">3900</span>,</span>
<span id="cb83-8"><a href="6-1-practical-3.html#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bquote</span>(<span class="fu">paste</span>(<span class="st">&quot;QP: &quot;</span>, sigma<span class="sc">^</span><span class="dv">2</span> <span class="sc">==</span> .(<span class="fu">round</span>(phi_fit, <span class="dv">1</span>)) <span class="sc">*</span> mu)),</span>
<span id="cb83-9"><a href="6-1-practical-3.html#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="dv">2</span></span>
<span id="cb83-10"><a href="6-1-practical-3.html#cb83-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-11"><a href="6-1-practical-3.html#cb83-11" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(x <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> x <span class="sc">/</span> k_fit), <span class="at">col =</span> <span class="dv">4</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-12"><a href="6-1-practical-3.html#cb83-12" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">104</span>, <span class="dv">7200</span>, <span class="fu">paste</span>(<span class="st">&quot;NB: k=&quot;</span>, <span class="fu">round</span>(k_fit, <span class="dv">1</span>), <span class="at">sep =</span> <span class="st">&quot;&quot;</span>), <span class="at">col =</span> <span class="dv">4</span>)</span>
<span id="cb83-13"><a href="6-1-practical-3.html#cb83-13" aria-hidden="true" tabindex="-1"></a>l_fit <span class="ot">&lt;-</span> <span class="fu">loess</span>(grp_vars <span class="sc">~</span> grp_means)</span>
<span id="cb83-14"><a href="6-1-practical-3.html#cb83-14" aria-hidden="true" tabindex="-1"></a>mvec <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">120</span></span>
<span id="cb83-15"><a href="6-1-practical-3.html#cb83-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(mvec, <span class="fu">predict</span>(l_fit, mvec), <span class="at">col =</span> <span class="dv">5</span>)</span>
<span id="cb83-16"><a href="6-1-practical-3.html#cb83-16" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">100</span>, <span class="dv">2500</span>, <span class="st">&quot;loess&quot;</span>, <span class="at">col =</span> <span class="dv">5</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-43"></span>
<img src="BIO8940_book_files/figure-html/unnamed-chunk-43-1.svg" alt="Graphical evaluation of distribution to use" width="672" />
<p class="caption">
Figure 6.4: Graphical evaluation of distribution to use
</p>
</div>
<p>Same with ggplot</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="6-1-practical-3.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb84-2"><a href="6-1-practical-3.html#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(grp_means, grp_vars),</span>
<span id="cb84-3"><a href="6-1-practical-3.html#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> grp_means, <span class="at">y =</span> grp_vars)) <span class="sc">+</span></span>
<span id="cb84-4"><a href="6-1-practical-3.html#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb84-5"><a href="6-1-practical-3.html#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb84-6"><a href="6-1-practical-3.html#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">colour =</span> <span class="st">&quot;Loess&quot;</span>), <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb84-7"><a href="6-1-practical-3.html#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb84-8"><a href="6-1-practical-3.html#cb84-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">formula =</span> y <span class="sc">~</span> x <span class="sc">-</span> <span class="dv">1</span>, <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb84-9"><a href="6-1-practical-3.html#cb84-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">colour =</span> <span class="st">&quot;Q_Pois&quot;</span>)) <span class="sc">+</span></span>
<span id="cb84-10"><a href="6-1-practical-3.html#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb84-11"><a href="6-1-practical-3.html#cb84-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> <span class="cf">function</span>(x) x <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> x <span class="sc">/</span> k_fit),</span>
<span id="cb84-12"><a href="6-1-practical-3.html#cb84-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">colour =</span> <span class="st">&quot;Neg_bin&quot;</span>)</span>
<span id="cb84-13"><a href="6-1-practical-3.html#cb84-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb84-14"><a href="6-1-practical-3.html#cb84-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(</span>
<span id="cb84-15"><a href="6-1-practical-3.html#cb84-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&quot;Poisson&quot;</span>)) <span class="sc">+</span></span>
<span id="cb84-16"><a href="6-1-practical-3.html#cb84-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(</span>
<span id="cb84-17"><a href="6-1-practical-3.html#cb84-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;legend&quot;</span>,</span>
<span id="cb84-18"><a href="6-1-practical-3.html#cb84-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;purple&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb84-19"><a href="6-1-practical-3.html#cb84-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb84-20"><a href="6-1-practical-3.html#cb84-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;legend&quot;</span>,</span>
<span id="cb84-21"><a href="6-1-practical-3.html#cb84-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;purple&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb84-22"><a href="6-1-practical-3.html#cb84-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-44"></span>
<img src="BIO8940_book_files/figure-html/unnamed-chunk-44-1.svg" alt="Graphical evaluation of distribution to use with ggplot" width="672" />
<p class="caption">
Figure 6.5: Graphical evaluation of distribution to use with ggplot
</p>
</div>
<!-- Todo need to edit the color legend -->
<p>These fits are not rigorous statistical tests — they violate a variety of assumptions of linear regression (e.g. constant variance, independence), but they are good enough to give us an initial guess about what distributions we should use.</p>
<p><strong>Exercise</strong></p>
<ul>
<li>compare a simple quadratic fit to the data (i.e., without the linear part) with the negative binomial and quasipoisson fits
<!-- -  Draw a plot to suggest whether one might be able to stabilize the variance of the data by log(1 + x)-transforming the data. --></li>
</ul>
<div class="exer">
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="6-1-practical-3.html#cb86-1" aria-hidden="true" tabindex="-1"></a>lm3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(grp_vars <span class="sc">~</span> <span class="fu">I</span>(grp_means)<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span>) <span class="do">## quadratic fit</span></span>
<span id="cb86-2"><a href="6-1-practical-3.html#cb86-2" aria-hidden="true" tabindex="-1"></a>quad_fit <span class="ot">&lt;-</span> <span class="fu">coef</span>(lm3)</span>
<span id="cb86-3"><a href="6-1-practical-3.html#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="6-1-practical-3.html#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb86-5"><a href="6-1-practical-3.html#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(grp_means, grp_vars),</span>
<span id="cb86-6"><a href="6-1-practical-3.html#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> grp_means, <span class="at">y =</span> grp_vars)) <span class="sc">+</span></span>
<span id="cb86-7"><a href="6-1-practical-3.html#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb86-8"><a href="6-1-practical-3.html#cb86-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb86-9"><a href="6-1-practical-3.html#cb86-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">formula =</span> y <span class="sc">~</span> x <span class="sc">-</span> <span class="dv">1</span>, <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb86-10"><a href="6-1-practical-3.html#cb86-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">colour =</span> <span class="st">&quot;Q_Pois&quot;</span>)) <span class="sc">+</span></span>
<span id="cb86-11"><a href="6-1-practical-3.html#cb86-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb86-12"><a href="6-1-practical-3.html#cb86-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> <span class="cf">function</span>(x) x <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> x <span class="sc">/</span> k_fit),</span>
<span id="cb86-13"><a href="6-1-practical-3.html#cb86-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">colour =</span> <span class="st">&quot;Neg_bin&quot;</span>)</span>
<span id="cb86-14"><a href="6-1-practical-3.html#cb86-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb86-15"><a href="6-1-practical-3.html#cb86-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb86-16"><a href="6-1-practical-3.html#cb86-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>) <span class="sc">-</span> <span class="dv">1</span>, <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb86-17"><a href="6-1-practical-3.html#cb86-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">colour =</span> <span class="st">&quot;Quad&quot;</span>)) <span class="sc">+</span></span>
<span id="cb86-18"><a href="6-1-practical-3.html#cb86-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(</span>
<span id="cb86-19"><a href="6-1-practical-3.html#cb86-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;legend&quot;</span>,</span>
<span id="cb86-20"><a href="6-1-practical-3.html#cb86-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;purple&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb86-21"><a href="6-1-practical-3.html#cb86-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb86-22"><a href="6-1-practical-3.html#cb86-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;legend&quot;</span>,</span>
<span id="cb86-23"><a href="6-1-practical-3.html#cb86-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;purple&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb86-24"><a href="6-1-practical-3.html#cb86-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-45"></span>
<img src="BIO8940_book_files/figure-html/unnamed-chunk-45-1.svg" alt="Graphical evaluation of distribution to use including quadratic effect" width="672" />
<p class="caption">
Figure 6.6: Graphical evaluation of distribution to use including quadratic effect
</p>
</div>
</div>
<div id="plotting-the-response-vs-treatments" class="section level4" number="6.1.5.1">
<h4><span class="header-section-number">6.1.5.1</span> Plotting the response vs treatments</h4>
<p>Just to avoid surprises</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="6-1-practical-3.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat_tf, <span class="fu">aes</span>(<span class="at">x =</span> amd, <span class="at">y =</span> <span class="fu">log</span>(total.fruits <span class="sc">+</span> <span class="dv">1</span>), <span class="at">colour =</span> nutrient)) <span class="sc">+</span></span>
<span id="cb87-2"><a href="6-1-practical-3.html#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb87-3"><a href="6-1-practical-3.html#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## need to use as.numeric(amd) to get lines</span></span>
<span id="cb87-4"><a href="6-1-practical-3.html#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(amd)), <span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>) <span class="sc">+</span></span>
<span id="cb87-5"><a href="6-1-practical-3.html#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb87-6"><a href="6-1-practical-3.html#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;lines&quot;</span>)) <span class="sc">+</span></span>
<span id="cb87-7"><a href="6-1-practical-3.html#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>popu)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-46"></span>
<img src="BIO8940_book_files/figure-html/unnamed-chunk-46-1.svg" alt="Fruit production by treatments by population" width="672" />
<p class="caption">
Figure 6.7: Fruit production by treatments by population
</p>
</div>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="6-1-practical-3.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat_tf, <span class="fu">aes</span>(<span class="at">x =</span> amd, <span class="at">y =</span> <span class="fu">log</span>(total.fruits <span class="sc">+</span> <span class="dv">1</span>), <span class="at">colour =</span> gen)) <span class="sc">+</span></span>
<span id="cb88-2"><a href="6-1-practical-3.html#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb88-3"><a href="6-1-practical-3.html#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(amd)), <span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>) <span class="sc">+</span></span>
<span id="cb88-4"><a href="6-1-practical-3.html#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb88-5"><a href="6-1-practical-3.html#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## label_both adds variable name (&#39;nutrient&#39;) to facet labels</span></span>
<span id="cb88-6"><a href="6-1-practical-3.html#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> nutrient, <span class="at">labeller =</span> label_both)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-47"></span>
<img src="BIO8940_book_files/figure-html/unnamed-chunk-47-1.svg" alt="Fruit production by genotype by treatments" width="672" />
<p class="caption">
Figure 6.8: Fruit production by genotype by treatments
</p>
</div>
</div>
</div>
<div id="fitting-group-wise-glm" class="section level3" number="6.1.6">
<h3><span class="header-section-number">6.1.6</span> Fitting group-wise GLM</h3>
<p>Another general starting approach is to fit GLMs to each group of data separately, equivalent to treating the grouping variables as fixed effects.
This should result in reasonable variation among treatment effects. We first fit the models, and then examine the coefficients.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="6-1-practical-3.html#cb89-1" aria-hidden="true" tabindex="-1"></a>glm_lis <span class="ot">&lt;-</span> <span class="fu">lmList</span>(</span>
<span id="cb89-2"><a href="6-1-practical-3.html#cb89-2" aria-hidden="true" tabindex="-1"></a>  total.fruits <span class="sc">~</span> nutrient <span class="sc">*</span> amd <span class="sc">|</span> gen,</span>
<span id="cb89-3"><a href="6-1-practical-3.html#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat_tf,</span>
<span id="cb89-4"><a href="6-1-practical-3.html#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb89-5"><a href="6-1-practical-3.html#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.lmList</span>(glm_lis)</span></code></pre></div>
<pre><code>## Loading required package: reshape</code></pre>
<pre><code>## 
## Attaching package: &#39;reshape&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     rename</code></pre>
<pre><code>## The following objects are masked from &#39;package:tidyr&#39;:
## 
##     expand, smiths</code></pre>
<pre><code>## The following object is masked from &#39;package:Matrix&#39;:
## 
##     expand</code></pre>
<pre><code>## Using grp as id variables</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-48"></span>
<img src="BIO8940_book_files/figure-html/unnamed-chunk-48-1.svg" alt="Model coefficients for GLM fits on each genotype" width="672" />
<p class="caption">
Figure 6.9: Model coefficients for GLM fits on each genotype
</p>
</div>
<p>Three genotypes (5, 6, 34) have extreme coefficients (Fig. 5). A mixed model assumes that the underlying random effects are normally distributed, although we shouldn’t take these outliers too seriously at this point — we are not actually plotting the random effects, or even estimates of random effects (which are not themselves guaranteed to be normally distributed), but rather separate estimates for each group.
Create a plotting function for Q-Q plots of these coefficients to visualize the departure from normality.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="6-1-practical-3.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqmath.lmList</span>(glm_lis)</span></code></pre></div>
<pre><code>## Using  as id variables</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-49"></span>
<img src="BIO8940_book_files/figure-html/unnamed-chunk-49-1.svg" alt="Q-Q plots of model coefficients for GLM fits on each genotype" width="672" />
<p class="caption">
Figure 6.10: Q-Q plots of model coefficients for GLM fits on each genotype
</p>
</div>
<p>We see that these extreme coefficients fall far outside a normal error distribution. We shouldn’t take these outliers too seriously at this point — we are not actually plotting the random effects, or even estimates of random effects, but rather separate estimates for each group.
Especially if these groups have relatively small sample sizes, the estimates may eventually be “shrunk” closer to the mean when we do the mixed model.
We should nonetheless take care to see if the coefficients for these genotypes from the GLMM are still outliers, and take the same precautions as we usually do for outliers. For example, we can look back at the original data to see if there is something weird about the way those genotypes were collected, or try re-running the analysis without those genotypes to see if the results are robust.</p>
</div>
<div id="fitting-and-evaluating-glmms" class="section level3" number="6.1.7">
<h3><span class="header-section-number">6.1.7</span> Fitting and evaluating GLMMs</h3>
<p>Now we (try to) build and fit a full model, using <code>glmer</code> in the <code>emo::ji("pacakage")</code> <code>lme4</code>. This model has random effects for all genotype and population × treatment random effects, and for the nuisance variables for the rack and germination method (status). (Given the mean-variance relationship we saw it’s pretty clear that we are going to have to proceed eventually to a model with overdispersion, but we fit the Poisson model first for illustration.)</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="6-1-practical-3.html#cb98-1" aria-hidden="true" tabindex="-1"></a>mp1 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(total.fruits <span class="sc">~</span> nutrient <span class="sc">*</span> amd <span class="sc">+</span></span>
<span id="cb98-2"><a href="6-1-practical-3.html#cb98-2" aria-hidden="true" tabindex="-1"></a>  rack <span class="sc">+</span> status <span class="sc">+</span></span>
<span id="cb98-3"><a href="6-1-practical-3.html#cb98-3" aria-hidden="true" tabindex="-1"></a>  (amd <span class="sc">*</span> nutrient <span class="sc">|</span> popu) <span class="sc">+</span></span>
<span id="cb98-4"><a href="6-1-practical-3.html#cb98-4" aria-hidden="true" tabindex="-1"></a>  (amd <span class="sc">*</span> nutrient <span class="sc">|</span> gen),</span>
<span id="cb98-5"><a href="6-1-practical-3.html#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="at">data =</span> dat_tf, <span class="at">family =</span> <span class="st">&quot;poisson&quot;</span></span>
<span id="cb98-6"><a href="6-1-practical-3.html#cb98-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, : Model failed to converge with max|grad| = 0.00550538 (tol = 0.002, component 1)</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="6-1-practical-3.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">overdisp_fun</span>(mp1)</span></code></pre></div>
<pre><code>##       chisq       ratio           p 
## 13909.46583    23.25998     0.00000</code></pre>
<!-- add description of the overdispersion function -->
<p>We can ignore the model convergence for the moment. This shows that the data are (extremely) over-dispersed, given the model.</p>
<p>Now we add the observation-level random effect to the model to account for overdispersion <span class="citation">(<a href="references.html#ref-elston2001" role="doc-biblioref">Elston et al. 2001</a>)</span>.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="6-1-practical-3.html#cb102-1" aria-hidden="true" tabindex="-1"></a>mp2 <span class="ot">&lt;-</span> <span class="fu">update</span>(mp1, . <span class="sc">~</span> . <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> X))</span></code></pre></div>
<pre><code>## Warning in (function (fn, par, lower = rep.int(-Inf, n), upper = rep.int(Inf, : failure to converge in 10000 evaluations</code></pre>
<pre><code>## Warning in optwrap(optimizer, devfun, start, rho$lower, control = control, : convergence code 4 from Nelder_Mead: failure to converge in 10000 evaluations</code></pre>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<p>The model takes much longer to fit (and gives warnings).
We look just at the variance components. In particular, if we look at the correlation matrix among the genotype random effects, we see a perfect
correlation.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="6-1-practical-3.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(<span class="fu">VarCorr</span>(mp2)<span class="sc">$</span>gen, <span class="st">&quot;correlation&quot;</span>)</span></code></pre></div>
<pre><code>##                         (Intercept) amdclipped nutrientHigh amdclipped:nutrientHigh
## (Intercept)               1.0000000 -1.0000000   -0.9856190               0.8102082
## amdclipped               -1.0000000  1.0000000    0.9856458              -0.8103030
## nutrientHigh             -0.9856190  0.9856458    1.0000000              -0.8975369
## amdclipped:nutrientHigh   0.8102082 -0.8103030   -0.8975369               1.0000000</code></pre>
<p>We’ll try getting rid of the correlations between clipping (<code>amd</code>) and nutrients, using <code>amd+nutrient</code> instead of <code>amd*nutrient</code> in the random effects specification (here it seems easier to re-do the model rather than using update to add and subtract terms).</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="6-1-practical-3.html#cb108-1" aria-hidden="true" tabindex="-1"></a>mp3 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(total.fruits <span class="sc">~</span> nutrient <span class="sc">*</span> amd <span class="sc">+</span></span>
<span id="cb108-2"><a href="6-1-practical-3.html#cb108-2" aria-hidden="true" tabindex="-1"></a>  rack <span class="sc">+</span> status <span class="sc">+</span></span>
<span id="cb108-3"><a href="6-1-practical-3.html#cb108-3" aria-hidden="true" tabindex="-1"></a>  (amd <span class="sc">+</span> nutrient <span class="sc">|</span> popu) <span class="sc">+</span></span>
<span id="cb108-4"><a href="6-1-practical-3.html#cb108-4" aria-hidden="true" tabindex="-1"></a>  (amd <span class="sc">+</span> nutrient <span class="sc">|</span> gen) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> X),</span>
<span id="cb108-5"><a href="6-1-practical-3.html#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="at">data =</span> dat_tf, <span class="at">family =</span> <span class="st">&quot;poisson&quot;</span></span>
<span id="cb108-6"><a href="6-1-practical-3.html#cb108-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, : Model failed to converge with max|grad| = 0.216994 (tol = 0.002, component 1)</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="6-1-practical-3.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(<span class="fu">VarCorr</span>(mp3)<span class="sc">$</span>gen, <span class="st">&quot;correlation&quot;</span>)</span></code></pre></div>
<pre><code>##              (Intercept) amdclipped nutrientHigh
## (Intercept)    1.0000000 -0.9998765   -0.9970119
## amdclipped    -0.9998765  1.0000000    0.9969756
## nutrientHigh  -0.9970119  0.9969756    1.0000000</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="6-1-practical-3.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(<span class="fu">VarCorr</span>(mp3)<span class="sc">$</span>popu, <span class="st">&quot;correlation&quot;</span>)</span></code></pre></div>
<pre><code>##              (Intercept) amdclipped nutrientHigh
## (Intercept)    1.0000000  0.9958238    0.9947419
## amdclipped     0.9958238  1.0000000    0.9886630
## nutrientHigh   0.9947419  0.9886630    1.0000000</code></pre>
<p>Unfortunately, we still have perfect correlations among the random effects terms. For some models (e.g. random-slope models), it is possible to fit random effects models in such a way that the correlation between the different parameters (intercept and slope in the case of random-slope models) is constrained to be zero, by fitting a model like <code>(1|f)+(0+x|f)</code>; unfortunately, because of the way lme4 is set up, this is considerably more difficult with categorical predictors (factors).</p>
<p>We have to reduce the model further in some way in order not to overfit (i.e., in order to not have perfect ±1 correlations among random effects). It looks like we can’t allow both nutrients and clipping in the random effect model at either the population or the genotype level. However, it’s hard to know whether we should proceed with amd or nutrient, both, or neither in the model.</p>
<p>A convenient way to proceed if we are going to try fitting several different combinations of random effects is to fit the model with all the fixed effects but only observation-level random effects, and then to use update to add various components to it.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="6-1-practical-3.html#cb114-1" aria-hidden="true" tabindex="-1"></a>mp_obs <span class="ot">&lt;-</span> <span class="fu">glmer</span>(total.fruits <span class="sc">~</span> nutrient <span class="sc">*</span> amd <span class="sc">+</span></span>
<span id="cb114-2"><a href="6-1-practical-3.html#cb114-2" aria-hidden="true" tabindex="-1"></a>  rack <span class="sc">+</span> status <span class="sc">+</span></span>
<span id="cb114-3"><a href="6-1-practical-3.html#cb114-3" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">|</span> X),</span>
<span id="cb114-4"><a href="6-1-practical-3.html#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="at">data =</span> dat_tf, <span class="at">family =</span> <span class="st">&quot;poisson&quot;</span></span>
<span id="cb114-5"><a href="6-1-practical-3.html#cb114-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Now, for example, <code>update(mp_obs,.~.+(1|gen)+(amd|popu))</code> fits the model with intercept random effects at the genotype level and variation in clipping effects across populations.</p>

<div class="rmdcode">
<p><strong>Exercise</strong> using update, fit the models with</p>
<ol style="list-style-type: decimal">
<li>clipping variation at both genotype and population levels;</li>
<li>nutrient variation at both genotype and populations; convince yourself that trying to fit variation in either clipping or nutrients leads to overfitting (perfect correlations).</li>
<li>Fit the model with only intercept variation at the population and genotype levels, saving it as mp4; show that there is non-zero variance estimated</li>
</ol>
</div>
<div class="exer">
<ol style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="6-1-practical-3.html#cb115-1" aria-hidden="true" tabindex="-1"></a>mpcli <span class="ot">&lt;-</span> <span class="fu">update</span>(mp_obs, . <span class="sc">~</span> . <span class="sc">+</span> (amd <span class="sc">|</span> gen) <span class="sc">+</span> (amd <span class="sc">|</span> popu))</span></code></pre></div>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, : Model failed to converge with max|grad| = 0.115116 (tol = 0.002, component 1)</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="6-1-practical-3.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VarCorr</span>(mpcli)</span></code></pre></div>
<pre><code>##  Groups Name        Std.Dev. Corr  
##  X      (Intercept) 1.429806       
##  gen    (Intercept) 0.296991       
##         amdclipped  0.039336 -0.869
##  popu   (Intercept) 0.752718       
##         amdclipped  0.126028 0.995</code></pre>
<ol start="2" style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="6-1-practical-3.html#cb119-1" aria-hidden="true" tabindex="-1"></a>mpnut <span class="ot">&lt;-</span> <span class="fu">update</span>(mp_obs, . <span class="sc">~</span> . <span class="sc">+</span> (nutrient <span class="sc">|</span> gen) <span class="sc">+</span> (nutrient <span class="sc">|</span> popu))</span></code></pre></div>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, : Model failed to converge with max|grad| = 0.0204136 (tol = 0.002, component 1)</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="6-1-practical-3.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VarCorr</span>(mpnut)</span></code></pre></div>
<pre><code>##  Groups Name         Std.Dev. Corr  
##  X      (Intercept)  1.41953        
##  gen    (Intercept)  0.47799        
##         nutrientHigh 0.32458  -1.000
##  popu   (Intercept)  0.74706        
##         nutrientHigh 0.12042  1.000</code></pre>
<ol start="3" style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="6-1-practical-3.html#cb123-1" aria-hidden="true" tabindex="-1"></a>mp4 <span class="ot">&lt;-</span> <span class="fu">update</span>(mp_obs, . <span class="sc">~</span> . <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> gen) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> popu))</span></code></pre></div>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, : Model failed to converge with max|grad| = 0.00263265 (tol = 0.002, component 1)</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="6-1-practical-3.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VarCorr</span>(mp4)</span></code></pre></div>
<pre><code>##  Groups Name        Std.Dev.
##  X      (Intercept) 1.43113 
##  gen    (Intercept) 0.28577 
##  popu   (Intercept) 0.80616</code></pre>
</div>
<p>In other words, while it’s biologically plausible that there is some variation in the nutrient or clipping effect at the genotype or population levels, with this modeling approach we really don’t have enough data to speak confidently about these effects.
Let’s check that mp4 no longer incorporates overdispersion (the observationlevel random effect should have taken care of it):</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="6-1-practical-3.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">overdisp_fun</span>(mp4)</span></code></pre></div>
<pre><code>##       chisq       ratio           p 
## 177.5567880   0.2887102   1.0000000</code></pre>
</div>
<div id="inference" class="section level3" number="6.1.8">
<h3><span class="header-section-number">6.1.8</span> Inference</h3>
<div id="random-effects" class="section level4" number="6.1.8.1">
<h4><span class="header-section-number">6.1.8.1</span> Random effects</h4>
<p><code>glmer</code> (<code>lmer</code>) does not return information about the standard errors or confidence intervals of the variance components.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="6-1-practical-3.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VarCorr</span>(mp4)</span></code></pre></div>
<pre><code>##  Groups Name        Std.Dev.
##  X      (Intercept) 1.43113 
##  gen    (Intercept) 0.28577 
##  popu   (Intercept) 0.80616</code></pre>
<div id="testing-for-random-effects-1" class="section level5" number="6.1.8.1.1">
<h5><span class="header-section-number">6.1.8.1.1</span> Testing for random Effects</h5>
<p>If we want to test the significance of the random effects we can fit reduced models and run likelihood ratio tests via anova, keeping in mind that in this case (testing a null hypothesis of zero variance, where the parameter is on the boundary of its feasible region) the reported p value is approximately twice what it should be.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="6-1-practical-3.html#cb131-1" aria-hidden="true" tabindex="-1"></a>mp4v1 <span class="ot">&lt;-</span> <span class="fu">update</span>(mp_obs, . <span class="sc">~</span> . <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> popu)) <span class="do">## popu only (drop gen)</span></span>
<span id="cb131-2"><a href="6-1-practical-3.html#cb131-2" aria-hidden="true" tabindex="-1"></a>mp4v2 <span class="ot">&lt;-</span> <span class="fu">update</span>(mp_obs, . <span class="sc">~</span> . <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> gen)) <span class="do">## gen only (drop popu)</span></span></code></pre></div>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, : Model failed to converge with max|grad| = 0.105093 (tol = 0.002, component 1)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, : Model is nearly unidentifiable: very large eigenvalue
##  - Rescale variables?</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="6-1-practical-3.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mp4, mp4v1)</span></code></pre></div>
<pre><code>## Data: dat_tf
## Models:
## mp4v1: total.fruits ~ nutrient + amd + rack + status + (1 | X) + (1 | 
## mp4v1:     popu) + nutrient:amd
## mp4: total.fruits ~ nutrient + amd + rack + status + (1 | X) + (1 | 
## mp4:     gen) + (1 | popu) + nutrient:amd
##       npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)  
## mp4v1    9 5017.4 5057.4 -2499.7   4999.4                       
## mp4     10 5015.4 5059.8 -2497.7   4995.4 4.0638  1    0.04381 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="6-1-practical-3.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mp4, mp4v2)</span></code></pre></div>
<pre><code>## Data: dat_tf
## Models:
## mp4v2: total.fruits ~ nutrient + amd + rack + status + (1 | X) + (1 | 
## mp4v2:     gen) + nutrient:amd
## mp4: total.fruits ~ nutrient + amd + rack + status + (1 | X) + (1 | 
## mp4:     gen) + (1 | popu) + nutrient:amd
##       npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)    
## mp4v2    9 5031.6 5071.5 -2506.8   5013.6                         
## mp4     10 5015.4 5059.8 -2497.7   4995.4 18.212  1  1.976e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>For various forms of linear mixed models, the RLRsim package can do efficient simulation-based hypothesis testing of variance components — un- fortunately, that doesn’t include GLMMs.
If we are sufficiently patient we can do hypothesis testing via brute-force parametric bootstrapping where we repeatedly simulate data from the reduced (null) model, fit both the re- duced and full models to the simulated data, and compute the distribution of the deviance (change in -2 log likelihood).
The code below took about half an hour on a reasonably modern desktop computer.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="6-1-practical-3.html#cb138-1" aria-hidden="true" tabindex="-1"></a>simdev <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb138-2"><a href="6-1-practical-3.html#cb138-2" aria-hidden="true" tabindex="-1"></a>  newdat <span class="ot">&lt;-</span> <span class="fu">simulate</span>(mp4v1)</span>
<span id="cb138-3"><a href="6-1-practical-3.html#cb138-3" aria-hidden="true" tabindex="-1"></a>  reduced <span class="ot">&lt;-</span> lme4<span class="sc">::</span><span class="fu">refit</span>(mp4v1, newdat)</span>
<span id="cb138-4"><a href="6-1-practical-3.html#cb138-4" aria-hidden="true" tabindex="-1"></a>  full <span class="ot">&lt;-</span> lme4<span class="sc">::</span><span class="fu">refit</span>(mp4, newdat)</span>
<span id="cb138-5"><a href="6-1-practical-3.html#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span> <span class="sc">*</span> (<span class="fu">c</span>(<span class="fu">logLik</span>(full) <span class="sc">-</span> <span class="fu">logLik</span>(reduced)))</span>
<span id="cb138-6"><a href="6-1-practical-3.html#cb138-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb138-7"><a href="6-1-practical-3.html#cb138-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-8"><a href="6-1-practical-3.html#cb138-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">101</span>)</span>
<span id="cb138-9"><a href="6-1-practical-3.html#cb138-9" aria-hidden="true" tabindex="-1"></a>nulldist0 <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">2</span>, <span class="fu">simdev</span>())</span>
<span id="cb138-10"><a href="6-1-practical-3.html#cb138-10" aria-hidden="true" tabindex="-1"></a><span class="do">## zero spurious (small) negative values</span></span>
<span id="cb138-11"><a href="6-1-practical-3.html#cb138-11" aria-hidden="true" tabindex="-1"></a>nulldist[nulldist <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">abs</span>(nulldist) <span class="sc">&lt;</span> <span class="fl">1e-5</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb138-12"><a href="6-1-practical-3.html#cb138-12" aria-hidden="true" tabindex="-1"></a>obsdev <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">c</span>(<span class="fu">logLik</span>(mp4) <span class="sc">-</span> <span class="fu">logLik</span>(mp4v1))</span></code></pre></div>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="6-1-practical-3.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">c</span>(nulldist, obsdev) <span class="sc">&gt;=</span> obsdev)</span></code></pre></div>
<pre><code>## [1] 0.01492537</code></pre>
<p>The true p-value is actually closer to 0.05 than 0.02. In other words, here the deviations from the original statistical model from that for which the original “p value is inflated by 2” rule of thumb was derived — fitting a GLMM instead of a LMM, and using a moderate-sized rather than an arbitrarily large (asymptotic) data set — have made the likelihood ratio test liberal (increased type I error) rather than conservative (decreased type I error).</p>
<p>We can also inspect the random effects estimates themselves (in proper statistical jargon, these might be considered “predictions” rather than “estimates” (Robinson, 1991)). We use the built-in dotplot method for the random effects extracted from glmer fits (i.e. ranef(model,condVar=TRUE)), which returns a list of plots, one for each random effect level in the model.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="6-1-practical-3.html#cb141-1" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">ranef</span>(mp4, <span class="at">condVar =</span> <span class="cn">TRUE</span>, <span class="at">whichel =</span> <span class="fu">c</span>(<span class="st">&quot;gen&quot;</span>, <span class="st">&quot;popu&quot;</span>)))</span>
<span id="cb141-2"><a href="6-1-practical-3.html#cb141-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">subset</span>(r1, grpvar <span class="sc">==</span> <span class="st">&quot;gen&quot;</span>), <span class="fu">aes</span>(<span class="at">y =</span> grp, <span class="at">x =</span> condval)) <span class="sc">+</span></span>
<span id="cb141-3"><a href="6-1-practical-3.html#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb141-4"><a href="6-1-practical-3.html#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(</span>
<span id="cb141-5"><a href="6-1-practical-3.html#cb141-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xmin =</span> condval <span class="sc">-</span> condsd <span class="sc">*</span> <span class="fl">1.96</span>, <span class="at">xmax =</span> condval <span class="sc">+</span> condsd <span class="sc">*</span> <span class="fl">1.96</span>)</span>
<span id="cb141-6"><a href="6-1-practical-3.html#cb141-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb141-7"><a href="6-1-practical-3.html#cb141-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb141-8"><a href="6-1-practical-3.html#cb141-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb141-9"><a href="6-1-practical-3.html#cb141-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb141-10"><a href="6-1-practical-3.html#cb141-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">subset</span>(r1, grpvar <span class="sc">==</span> <span class="st">&quot;popu&quot;</span>), <span class="fu">aes</span>(<span class="at">y =</span> grp, <span class="at">x =</span> condval)) <span class="sc">+</span></span>
<span id="cb141-11"><a href="6-1-practical-3.html#cb141-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb141-12"><a href="6-1-practical-3.html#cb141-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(</span>
<span id="cb141-13"><a href="6-1-practical-3.html#cb141-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xmin =</span> condval <span class="sc">-</span> condsd <span class="sc">*</span> <span class="fl">1.96</span>, <span class="at">xmax =</span> condval <span class="sc">+</span> condsd <span class="sc">*</span> <span class="fl">1.96</span>)</span>
<span id="cb141-14"><a href="6-1-practical-3.html#cb141-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb141-15"><a href="6-1-practical-3.html#cb141-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb141-16"><a href="6-1-practical-3.html#cb141-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb141-17"><a href="6-1-practical-3.html#cb141-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb141-18"><a href="6-1-practical-3.html#cb141-18" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-64"></span>
<img src="BIO8940_book_files/figure-html/unnamed-chunk-64-1.svg" alt="Distribution of BLUPs for genotypes and populations" width="672" />
<p class="caption">
Figure 6.11: Distribution of BLUPs for genotypes and populations
</p>
</div>
<p>As expected from the similarity of the variance estimates, the population-level estimates (the only shared component) do not differ much between the two models. There is a hint of regional differentiation — the Spanish populations have higher fruit sets than the Swedish and Dutch populations. Genotype 34 again looks a little bit unusual.</p>
</div>
</div>
<div id="fixed-effects" class="section level4" number="6.1.8.2">
<h4><span class="header-section-number">6.1.8.2</span> Fixed effects</h4>
<p>Now we want to do inference on the fixed effects. We use the drop1 func- tion to assess both the AIC difference and the likelihood ratio test between models. (In glmm_funs.R we define a convenience function dfun to convert the AIC tables returned by drop1 (which we will create momentarily) into ∆AIC tables.) Although the likelihood ratio test (and the AIC) are asymptotic tests, comparing fits between full and reduced models is still more accurate than the Wald (curvature-based) tests shown in the summary tables for glmer fits.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="6-1-practical-3.html#cb142-1" aria-hidden="true" tabindex="-1"></a>(dd_aic <span class="ot">&lt;-</span> <span class="fu">dfun</span>(<span class="fu">drop1</span>(mp4)))</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## total.fruits ~ nutrient + amd + rack + status + (1 | X) + (1 | 
##     gen) + (1 | popu) + nutrient:amd
##              npar   dAIC
## &lt;none&gt;             0.000
## rack            1 55.083
## status          2  1.612
## nutrient:amd    1  1.444</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="6-1-practical-3.html#cb144-1" aria-hidden="true" tabindex="-1"></a>(dd_lrt <span class="ot">&lt;-</span> <span class="fu">drop1</span>(mp4, <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>))</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## total.fruits ~ nutrient + amd + rack + status + (1 | X) + (1 | 
##     gen) + (1 | popu) + nutrient:amd
##              npar    AIC    LRT   Pr(Chi)    
## &lt;none&gt;            5015.4                     
## rack            1 5070.5 57.083 4.179e-14 ***
## status          2 5017.0  5.612   0.06044 .  
## nutrient:amd    1 5016.8  3.444   0.06349 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>On the basis of these comparisons, there appears to be a very strong effect of rack and weak effects of status and of the interaction term. Dropping the nutrient:amd interaction gives a (slightly) increased AIC (∆AIC = 1.4), so the full model has the best expected predictive capability (by a small margin). On the other hand, the p-value is slightly above 0.05 (p = 0.06). At this point we remove the non-significant interaction term so we can test the main effects. (We don’t worry about removing status because it measures an aspect of experimental design that we want to leave in the model whether it is significant or not.) Once we have fitted the reduced model, we can run the LRT via anova.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="6-1-practical-3.html#cb146-1" aria-hidden="true" tabindex="-1"></a>mp5 <span class="ot">&lt;-</span> <span class="fu">update</span>(mp4, . <span class="sc">~</span> . <span class="sc">-</span> amd<span class="sc">:</span>nutrient)</span>
<span id="cb146-2"><a href="6-1-practical-3.html#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mp5, mp4)</span></code></pre></div>
<pre><code>## Data: dat_tf
## Models:
## mp5: total.fruits ~ nutrient + amd + rack + status + (1 | X) + (1 | 
## mp5:     gen) + (1 | popu)
## mp4: total.fruits ~ nutrient + amd + rack + status + (1 | X) + (1 | 
## mp4:     gen) + (1 | popu) + nutrient:amd
##     npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)  
## mp5    9 5016.8 5056.8 -2499.4   4998.8                       
## mp4   10 5015.4 5059.8 -2497.7   4995.4 3.4438  1    0.06349 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><strong>Exercise</strong>
Test now the reduced model.</p>
<p>In the reduced model, we find that both nutrients and clipping have strong effects, whether measured by AIC or LRT. If we wanted to be still more careful about our interpretation, we would try to relax the asymptotic assumption. In classical linear models, we would do this by doing F tests with the appropriate denominator degrees of freedom. In “modern” mixed model approaches, we might try to use denominator-degree-of-freedom approximations such as the Kenward-Roger (despite the controversy over these approximations, they are actually available in <code>lmerTest</code>, but they do not apply to GLMMs. We can use a parametric bootstrap comparison between nested models to test fixed effects, as we did above for random effects, with the caveat that is computationally slow.</p>
<p>In addition, we can check the normality of the random effects and find they are reasonable (Fig. 10).</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="6-1-practical-3.html#cb148-1" aria-hidden="true" tabindex="-1"></a>r5 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">ranef</span>(mp5))</span>
<span id="cb148-2"><a href="6-1-practical-3.html#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> r5, <span class="fu">aes</span>(<span class="at">sample =</span> condval)) <span class="sc">+</span></span>
<span id="cb148-3"><a href="6-1-practical-3.html#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span> <span class="fu">geom_qq_line</span>() <span class="sc">+</span></span>
<span id="cb148-4"><a href="6-1-practical-3.html#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> grpvar) <span class="sc">+</span></span>
<span id="cb148-5"><a href="6-1-practical-3.html#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-67"></span>
<img src="BIO8940_book_files/figure-html/unnamed-chunk-67-1.svg" alt="Q-Q plot of BLUPs from model mp5" width="672" />
<p class="caption">
Figure 6.12: Q-Q plot of BLUPs from model mp5
</p>
</div>
</div>
</div>
<div id="conclusions" class="section level3" number="6.1.9">
<h3><span class="header-section-number">6.1.9</span> Conclusions</h3>
<p>Our final model includes fixed effects of nutrients and clipping, as well as the nuisance variables rack and status; observation-level random effects to ac- count for overdispersion; and variation in overall fruit set at the population and genotype levels. However, we don’t (apparently) have quite enough in- formation to estimate the variation in clipping and nutrient effects, or their interaction, at the genotype or population levels. There is a strong overall positive effect of nutrients and a slightly weaker negative effect of clipping. The interaction between clipping and nutrients is only weakly supported (i.e. the p-value is not very small), but it is positive and about the same magnitude as the clipping effect, which is consistent with the statement that “nutrients cancel out the effect of herbivory.”</p>

<div class="rmdcode">
<p><strong>Exercise</strong></p>
<ul>
<li>Re-do the analysis with region as a fixed effect.</li>
<li>Re-do the analysis with a one-way layout as suggested above</li>
</ul>
</div>
</div>
<div id="happy-generalized-mixed-modelling" class="section level3" number="6.1.10">
<h3><span class="header-section-number">6.1.10</span> Happy generalized mixed-modelling</h3>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-69"></span>
<img src="images/Thorn.png" alt="A GLMM character" width="50%" />
<p class="caption">
Figure 6.13: A GLMM character
</p>
</div>

</div>
</div>
<!-- </div> -->
<script src="js/solution.js"></script>
            </section>

          </div>
        </div>
      </div>
<a href="6-introduction-to-glmm.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="7-introduction-to-bayesian-inference.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/BIO8940-uOttawa/class_book/02_03-intro_glmm.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["BIO8940_book.pdf", "BIO8940_book.epub", "BIO8940_book.mobi"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
